{% extends 'base.html' %}

{% block content %}
<div class="flex flex-col items-center justify-center min-h-screen gap-4">
    <div class="card w-96 bg-base-100 shadow-xl p-8">
        <h2 class="text-xl font-bold text-center mb-8">Training on CIFAR image: {{ cifar_index }}...</h2>
        
        <div class="flex flex-col items-center gap-2">
            <span class="loading loading-bars loading-xl"></span>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const socket = io();

        socket.on('connect', () => {
            socket.emit('start_single_process', {
                cifar_index: {{ cifar_index }},
                activation_function: '{{ activation_function }}'
            });
        });

        socket.on('complete', function(data) {
            let result = data.result;
            console.log('Result:', result);
            result.cifar_index = {{ cifar_index }};
            window.location.href = "{{ url_for('result') }}?data=" + 
                                 encodeURIComponent(JSON.stringify(data.result));
        });

        socket.on('error', function(error) {
            console.error('Error:', error);
            alert('An error occurred: ' + error);
        });
    });
</script>
{% endblock %}