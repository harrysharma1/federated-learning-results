{% extends 'base.html' %}
{% block content %}
<div class="flex flex-row min-h-screen justify-center items-center">
    <div class="card w-96 bg-base-100 shadow-xl">
        <!-- Tabs using DaisyUI's role tabs -->
        <div role="tablist" class="tabs tabs-boxed bg-base-200 m-2">
            <a role="tab" class="tab tab-active" id="individual_tab">Individual</a>
            <a role="tab" class="tab" id="multiple_tab">Multiple</a>
        </div>

        <div class="tab-panels p-4">
            <!-- Individual Analysis Form -->
            <div id="individual_content" class="space-y-4">
                <h2 class="card-title justify-center">Individual CIFAR Analysis</h2>
                <form class="space-y-4" action="{{ url_for('handle_data_single') }}", method="POST">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">CIFAR Index</span>
                        </label>
                        <input 
                            type="number" 
                            min="0" 
                            max="49999" 
                            placeholder="Enter index (0-49999)" 
                            class="input input-bordered" 
                            required 
                            name="cifar_index"
                        />
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Activation Function</span>
                        </label>
                        <select class="select select-bordered w-full" name="activation_function" required>
                            <option value="" disabled selected>Select Activation Function</option>
                            <option value="relu">ReLU</option>
                            <option value="sigmoid">Sigmoid</option>
                            <option value="tanh">Tanh</option>
                        </select>
                    </div>
                    <button class="btn btn-primary w-full">Analyze</button>
                </form>
            </div>

            <!-- Multiple Analysis Form -->
            <div id="multiple_content" class="space-y-4 hidden">
                <h2 class="card-title justify-center">Multiple CIFAR Analysis</h2>
                <form class="space-y-4" action="{{ url_for('handle_data_multiple') }}", method="POST">
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Beginning Index</span>
                        </label>
                        <input 
                            type="number" 
                            min="0" 
                            max="49999" 
                            placeholder="Enter starting index (0-49999)" 
                            class="input input-bordered" 
                            id="beginning_index"
                            required
                            name="start_cifar_index"
                        />
                    </div>
                    <div class="form-control">
                      <label class="label">
                          <span class="label-text">Range Size</span>
                          <span class="label-text-alt" id="range-size">1</span>
                      </label>
                      <input 
                          type="range" 
                          min="1" 
                          max="14" 
                          value="1"
                          class="range" 
                          id="range_slider"
                          required
                      />
                      <label class="label">
                          <span class="label-text-alt text-error" id="range-error"></span>
                      </label>
                  </div>
                  
                  <!-- Add a hidden input for the end index -->
                  <input type="hidden" id="ending_index" name="end_cifar_index" />
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">Activation Function</span>
                        </label>
                        <select class="select select-bordered w-full" name="activation_function" required>
                            <option value="" disabled selected>Select Activation Function</option>
                            <option value="relu">ReLU</option>
                            <option value="sigmoid">Sigmoid</option>
                            <option value="tanh">Tanh</option>
                        </select>
                    </div>
                    <button class="btn btn-primary w-full">Analyze Range</button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
      const individualTab = document.getElementById('individual_tab');
      const multipleTab = document.getElementById('multiple_tab');
      const individualContent = document.getElementById('individual_content');
      const multipleContent = document.getElementById('multiple_content');
      const beginningIndex = document.getElementById('beginning_index');
      const rangeSlider = document.getElementById('range_slider');
      const endingIndex = document.getElementById('ending_index');
      const rangeSize = document.getElementById('range-size');
      const rangeError = document.getElementById('range-error');
      const multipleForm = document.querySelector('#multiple_content form');
  
      // Tab switching logic
      individualTab.addEventListener('click', function() {
          individualTab.classList.add('tab-active');
          multipleTab.classList.remove('tab-active');
          individualContent.classList.remove('hidden');
          multipleContent.classList.add('hidden');
      });
  
      multipleTab.addEventListener('click', function() {
          multipleTab.classList.add('tab-active');
          individualTab.classList.remove('tab-active');
          multipleContent.classList.remove('hidden');
          individualContent.classList.add('hidden');
          // Trigger range update when switching to multiple tab
          updateRange();
      });
  
      function updateRange() {
        if (beginningIndex.value) {
            const start = parseInt(beginningIndex.value);
            const range = parseInt(rangeSlider.value);
            const end = start + range - 1;
    
            // Update display values
            rangeSize.textContent = `${range} images`;
            endingIndex.value = end;
    
            // Validate end doesn't exceed maximum (49999 for 0-based indexing)
            if (end > 49999) {
                beginningIndex.setCustomValidity('Range exceeds maximum index of 49999');
                rangeError.textContent = 'Range exceeds maximum index (49999)';
            } else if (start < 0) {
                beginningIndex.setCustomValidity('Starting index cannot be negative');
                rangeError.textContent = 'Starting index must be >= 0';
            } else {
                beginningIndex.setCustomValidity('');
                rangeError.textContent = `End index: ${end}`;
            }
        }
    }
  
      // Add event listeners
      beginningIndex.addEventListener('input', updateRange);
      rangeSlider.addEventListener('input', updateRange);
  

      // Form submission validation
      multipleForm.addEventListener('submit', function(event) {
        if (!beginningIndex.value) {
            event.preventDefault();
            beginningIndex.setCustomValidity('Please enter a starting index');
            beginningIndex.reportValidity();
        } else {
            const start = parseInt(beginningIndex.value);
            const range = parseInt(rangeSlider.value);
            const end = start + range - 1;
            
            if (end > 49999) {
                event.preventDefault();
                beginningIndex.setCustomValidity('Range exceeds maximum index of 49999');
                beginningIndex.reportValidity();
            }
        }
      });
  
      // Initialize display values
      rangeSize.textContent = `${rangeSlider.value} images`;
  });
  </script>
{% endblock %}